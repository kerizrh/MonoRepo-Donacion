<div class="wrapper">
  <div class="encabezado">
    <h1>Campañas de donación</h1>
    <a routerLink="/campanias/nueva" class="btn-primario">Nueva campaña</a>
  </div>

  <div *ngIf="cargando" class="alert info">Cargando campañas…</div>
  <div *ngIf="error" class="alert error">{{ error }}</div>
  <div *ngIf="!cargando && !error && campanias.length === 0" class="alert warn">
    Aún no hay campañas. Crea la primera.
  </div>

  <div class="grid" *ngIf="campanias.length">
    <div class="card" *ngFor="let c of campanias; trackBy: trackById" [routerLink]="['/campanias', c.id]" style="cursor:pointer;">
      <img *ngIf="c.imagen" class="banner" [src]="'data:image/*;base64,'+c.imagen" alt="Banner campaña" style="width:100%; max-height:160px; object-fit:cover; border-radius:8px; margin-bottom:8px;" />

      <div class="card-header">
        <h3 class="nombre">{{ c.nombre }}</h3>
        <div class="fecha">{{ fechaRestanteTexto(c) }}</div>
      </div>

      <p class="descripcion">{{ c.descripcion }}</p>

      <div class="meta">
        <div><strong>Meta:</strong> {{ c.metaFondos | currency:'USD':'symbol':'1.2-2' }}</div>
        <div><strong>Recaudado:</strong> {{ c.montoRecaudado | currency:'USD':'symbol':'1.2-2' }}</div>
        <div class="progreso"><strong>Progreso:</strong> <span>{{ progreso(c) }}%</span></div>
      </div>

      <div class="barra-progreso">
        <div class="barra" [style.width.%]="progreso(c)" style="height:100%; border-radius:999px;"></div>
      </div>

      <div class="acciones">
        <button (click)="$event.stopPropagation(); startEdit(c)" class="btn-secundario">Editar</button>
        <button (click)="$event.stopPropagation(); eliminar(c)" class="btn-peligro">Eliminar</button>
      </div>

      <div class="editor" *ngIf="editId === c.id" (click)="$event.stopPropagation()">
        <label>Nombre
          <input type="text" [(ngModel)]="editNombre" />
        </label>
        <label>Fecha límite
          <input type="date" [(ngModel)]="editFechaLimite" />
        </label>
        <label>Meta a recaudar (USD)
          <input type="number" min="0" step="0.01" [(ngModel)]="editMetaFondos" />
        </label>
        <label>Descripción
          <textarea rows="3" [(ngModel)]="editDescripcion"></textarea>
        </label>
        <div style="display:flex; gap:8px; margin-top:6px;">
          <button (click)="$event.stopPropagation(); saveEdit(c)" class="btn-primario">Guardar</button>
          <button (click)="$event.stopPropagation(); cancelEdit()" class="btn-secundario">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
</div>
