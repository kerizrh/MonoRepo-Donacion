<div class="wrapper">
  <div class="encabezado-principal">
    <h1>Campañas de Donación</h1>
    <a routerLink="/campanias/nueva" class="btn-nuevo">Nueva campaña</a>
  </div>

  <div *ngIf="cargando" class="alert info">Cargando campañas…</div>
  <div *ngIf="error" class="alert error">{{ error }}</div>
  <div *ngIf="!cargando && !error && campanias.length === 0" class="alert warn">
    Aún no hay campañas. Crea la primera.
  </div>

  <div class="grid" *ngIf="campanias.length">
    <div class="card" *ngFor="let c of campanias; trackBy: trackById" [routerLink]="['/campanias', c.id]"
      style="cursor:pointer;">
      
      <div class="img-container">
        <img *ngIf="c.imagen" [src]="'data:image/*;base64,'+c.imagen" alt="Banner campaña" />
        <div *ngIf="!c.imagen" class="img-placeholder"></div>
      </div>

      <div class="card-body">
        <div class="card-header">
          <h3 class="nombre">{{ c.nombre }}</h3>
          <div class="estado">{{ fechaRestanteTexto(c) }}</div>
        </div>

        <div class="categorias">
          <span *ngFor="let cat of c.categorias" class="chip">{{ cat }}</span>
        </div>

        <div class="barra-progreso-bg">
          <div class="barra-fill" [style.width.%]="progreso(c)"></div>
        </div>

        <div class="stats-grid">
          <div class="stat-col left">
            <span class="label">Meta:</span>
            <span class="value">{{ c.metaFondos | currency:'USD':'symbol':'1.2-2' }}</span>
          </div>
          <div class="stat-col center">
            <span class="label">Recaudado:</span>
            <span class="value">{{ c.montoRecaudado | currency:'USD':'symbol':'1.2-2' }}</span>
          </div>
          <div class="stat-col right">
            <span class="label">Progreso:</span>
            <span class="value">{{ progreso(c) }}%</span>
          </div>
        </div>

        <div class="acciones">
          <button (click)="$event.stopPropagation(); startEdit(c)" class="btn-editar">
            <i class="icon-pencil"></i> Editar
          </button>
          <button (click)="$event.stopPropagation(); eliminar(c)" class="btn-eliminar">
            <i class="icon-trash"></i> Eliminar
          </button>
        </div>

        <div class="editor" *ngIf="editId === c.id" (click)="$event.stopPropagation()">
          <h4>Editar Campaña</h4>
          <label>Nombre <input type="text" [(ngModel)]="editNombre" /></label>
          <label>Fecha límite <input type="date" [(ngModel)]="editFechaLimite" /></label>
          <label>Meta (USD) <input type="number" [(ngModel)]="editMetaFondos" /></label>
          <label>Descripción <textarea rows="2" [(ngModel)]="editDescripcion"></textarea></label>
          <label>Categorías <input type="text" [(ngModel)]="editCategoriasTexto" /></label>

          <div class="editor-btns">
            <button (click)="$event.stopPropagation(); saveEdit(c)" class="btn-nuevo">Guardar</button>
            <button (click)="$event.stopPropagation(); cancelEdit()" class="btn-cancelar">Cancelar</button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>